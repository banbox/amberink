以太坊及Layer2区块链适合执行智能合约，但其昂贵的 Gas 费决定了它不适合存储文章、图片等大体积数据，且不支持复杂的检索功能。为了解决 Web3 应用在“存储成本”与“查询效率”之间的矛盾，AmberInk 采用了一套解耦的去中心化架构。

## 核心技术栈与架构设计

AmberInk 将传统的后端角色拆分为：**智能合约（业务逻辑） + Subsquid（关系索引） + Irys & Arweave（数据存储）**。

**前端层：** 基于 SvelteKit 构建的纯静态页面，采用响应式设计并集成 Paraglide 实现多语言支持。 前端可以部署在任何去中心化存储（如 IPFS 或 Swarm）中，实现真正的抗审查访问。

**合约层：** 运行在 Optimism 等 Layer2 网络，采用账户抽象（Account Abstract）技术。

**存储层：** 由 Arweave 提供永久存储保证，通过 Irys 网关实现毫秒级的即时确认。

**索引层：** 利用 Subsquid 去中心化索引器，将链上异步的 Event 数据转化为可供 GraphQL 查询的关系型数据库。

![01.jpg](01.jpg)

## 永久存储与数据更新逻辑

长文、图片等数据并非直接上链，而是将其哈希值作为“存在性证明”存入区块链。去中心化存储区块链则通过共识机制（如随机访问证明）确保数据在物理硬盘上**真实、持续**地存在。

在具体实现上，Filecoin 采用租金模式按需存储；而 Arweave 则要求用户一次性预付约 200 年的成本，再通过捐赠基金保障永久存储；这对于文字等高价值密度数据尤为适用。

AmberInk的存储层使用Arweave + Irys方案，Arweave提供永久存储保证，Irys提供快速上传和即时确认（无需等待区块确认）。

在 Arweave 上，数据一旦写入即永久存在。但对于内容平台而言，文章的修订与迭代是刚需。AmberInk 并没有强行改变区块链的不可篡改性，而是通过“逻辑寻址”实现了可更新性：不使用数据哈希（如 IPFS 的 CID）作为访问入口，而是利用交易哈希作为指向最新数据的软链接(即irys中的可更新文件夹)。 每次更新内容时，系统会产生新的数据哈希并与原有的软链接关联。

这种设计使得系统可以读取最新内容，同时也可在前端查看所有历史版本，还可作为创作过程的完整记录，证明原创性和思想演进轨迹。

## 基于Event的去中心化索引（Subsquid）

在智能合约中直接存储大量状态（如文章列表、评论列表）是非常昂贵的。AmberInk 采取了“链上触发，链下索引”的策略：

**最小化链上状态：** 凡是合约逻辑不需要使用的数据（如标题、标签、评论内容），一律不进入 Contract State，而是通过 emit Event 触发。

**实时索引流：** Subsquid 作为一个去中心化索引器，会持续监听 Layer2 链上的 Event 输出流。我们预定义了 Schema 结构，Subsquid 会根据 Event 数据自动更新其内部的关系型数据库表。

**GraphQL 查询**： 前端无需直接与复杂的区块链节点通信，而是通过标准化的 GraphQL 接口查询文章点赞数、作者作品集或搜索特定标签。这种方案在保持去中心化的同时，提供了接近 Web2 的查询响应速度。

## 智能合约和业务逻辑

智能合约基于Solidity开发，部署在Layer2主网（低Gas费、高性能），采用透明代理模式的可升级设计，这确保了在发现漏洞或需要新增功能时可以安全升级，而用户的数据和资产始终保持安全。

为了避免 Web3 应用“每一步都要弹窗签名”的糟糕体验，AmberInk 引入了会话秘钥（Session Key）机制，用户在登录时进行一次主钱包授权，生成一个具有时效性和权限限制的临时秘钥。之后的点赞、评论等操作均由该秘钥静默签名，消除了频繁唤起 Metamask 的干扰。

![02.jpg](02.jpg)

## 静态前端分发

现代前端应用多使用SSR服务器端渲染，这就要求请求某个中心化服务器才能得到渲染后的前端页面；虽然也可通过Akash Network这类去中心化计算网络实现后端服务器的去中心化，但额外的成本对于目前简单的前端场景来说是没必要的。

所以AmberInk采用了静态前端方案，直接部署到ETH Swarm的去中心化存储，定期续期；并使用ENS绑定到amberink.eth域名，方便用户访问（国内可使用amberink.top加速域名）。

前端技术上基于SvelteKit构建，Web3集成方面使用viem作为轻量级的以太坊交互库。

## 开源与透明

AmberInk的所有代码都在GitHub上开源，任何人都可以审计代码，提交漏洞，完善功能。完全开源也让所有逻辑都透明可查。

另外，此项目完全是由AI开发完成的，我们提供了详细的[开发日志](https://github.com/banbox/amberink/blob/main/learn/README.md)，记录了从零到一的每个步骤。

## 目前的问题与局限

**女巫攻击（Sybil Attack）：** 由于创建钱包零门槛，虚假热度现在难以防范。目前暂时通过较高的平台费率（打赏收取10%，点不喜欢所支付费用全额归平台）提高攻击的经济成本。长期方案是集成主流去DID（中心化身份）协议，对真实创作者低费率，对匿名发布收取更高费率，进一步提升数据可信度。

**Api服务商：** 当前只能通过网页手动发布文章，还必须安装钱包扩展，持有ETH；未来将支持Api服务，将前端的各种交易逻辑封装为接口服务，用户只需配置服务商的接口和apikey，然后允许服务商为自己生成钱包私钥并充值对应金额的加密货币，这些接口可直接在AmberInk上使用，不需要您在浏览器安装web3钱包即可无感使用所有功能。

**去中心化程度：** 虽说当前应用是去中心化的，但并不意味着每次请求都由随机的区块链节点服务器处理。目前AmberInk合约链使用官方公共RPC端点，Subsquid使用自建服务器，irys使用官方网关。但也在设置中允许用户自行配置为其他URL。

**搜索与推荐：** 目前的搜索功能基于 Subsquid 的简单匹配，未来计划引入更强大的搜索。推荐算法也将基于用户的偏好和关注数据，通过开源算法透明地呈现。

**版权保护：** 虽然区块链时间戳可以证明首发时间，但如何防止他人抄袭后抢先发布，仍然需要更完善的机制。

**社区治理：** 完全去中心化的应用，不仅体现在技术层面，社区治理方面也应当做到完全去中心化。目前社区不够强大，所以暂时由项目方管理，后续应随着社区壮大逐步迁移到完全的DAO治理。

GitHub: [amberink](https://github.com/banbox/amberink)

Telegram: https://t.me/hi_web3_dapp